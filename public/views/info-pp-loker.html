<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">Sedang memuat data...</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4/animate.min.css"/>
  <link rel="stylesheet" href="../assets/infopp.css"/>
</head>

<body class="bg-light text-dark d-flex flex-column min-vh-100">

    <div id="loadingOverlay">
    <div class="loading-content text-center">
      <div class="spinner-border text-primary mb-3" role="status"></div>
      <div class="fw-semibold">Sedang memuat data...</div>
    </div>
  </div>

  <div class="container text-center py-5">
    <h1 id="mainTitle" class="fw-bold"></h1>
    <h2 id="subTitle"></h2>
    <p id="paragraph" class="lead"></p>
  </div>

  <footer id="footer" class="text-center mt-auto"></footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  $(document).ready(function () {
  
    const scriptUrl = "https://script.google.com/macros/s/AKfycby-SCJYg82ajGrbdhTz6zfg7ZCdPx3Zsv0DcnSqCgxxy8bVV_7EJo1214XDV7nHUS4/exec";
  
    // ===== Ambil parameter sheet dari URL browser =====
    const urlParams = new URLSearchParams(window.location.search);
    const sheetName = urlParams.get("sheet") || "Konten";
  
    // ===== Ambil data dari GAS =====
    $.getJSON(scriptUrl, { sheet: sheetName })
      .done(function (data) {
  
        if (data.error) {
          $("body").html(
            `<div class="text-center p-5 text-danger">${data.error}</div>`
          );
          return;
        }
  
        // Mapping data JSON ke elemen HTML
        document.title = data.title || "Tanpa Judul";
        $("#mainTitle").text(data.h1 || "");
        $("#subTitle").text(data.h2 || "");
        $("#paragraph").html(data.p || "");
  
        const footerHtml = (data.footer || "")
          .replace("{{year}}", new Date().getFullYear());
  
        $("#footer").html(footerHtml);
  
        aktifkanTombolWA();

        $("#loadingOverlay").addClass("fade-out"); // HILANGKAN LOADING
      })
      .fail(function () {
        $("body").html(
          "<div class='text-center p-5 text-danger'>Gagal menghubungi server.</div>"
        );
        $("#loadingOverlay").addClass("fade-out"); // HILANGKAN LOADING
      });
  
    // ===== Fungsi tombol WA (TIDAK DIUBAH LOGIKANYA) =====
    function aktifkanTombolWA() {
      $("#paragraph").on("click", ".btn-custom-wa", async function (e) {
        e.preventDefault();
  
        const { value: formValues } = await Swal.fire({
          title: 'Hubungi Kami',
          html: `
            <input id="swal-nama" class="swal2-input" placeholder="Nama">
            <textarea id="swal-isiPesan" class="swal2-textarea" placeholder="Isi Pesan"></textarea>
          `,
          showCancelButton: true,
          confirmButtonText: 'Kirim ke WhatsApp',
          cancelButtonText: 'Batal',
          confirmButtonColor: '#127720',
          cancelButtonColor: '#d33',
          allowOutsideClick: false,
          allowEscapeKey: false,
          showLoaderOnConfirm: true,
          preConfirm: async () => {
            const nama = document.getElementById('swal-nama').value.trim();
            const isiPesan = document.getElementById('swal-isiPesan').value.trim();
  
            if (!nama || !isiPesan) {
              Swal.showValidationMessage('Semua kolom wajib diisi ya!');
              return false;
            }
  
            await new Promise(resolve => setTimeout(resolve, 1000));
            return { nama, isiPesan };
          },
          showClass: { popup: 'animate__animated animate__zoomIn' },
          hideClass: { popup: 'animate__animated animate__zoomOut' }
        });
  
        if (formValues) {
          const ADMIN_WA = "6287713314496";
          const pesan =
            `Halo min, saya ${formValues.nama} minat posting iklan di @lokerkesehatanid\n\n` +
            `${formValues.isiPesan}`;
  
          window.location.href =
            `https://wa.me/${ADMIN_WA}?text=${encodeURIComponent(pesan)}`;
        }
      });
    }
  });
</script>
</body>
</html>